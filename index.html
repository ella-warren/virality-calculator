<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steve Mould Virality Calculator</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background: #f5f5f7; color: #333; }
        .container { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1 { margin-top: 0; color: #1d1d1f; }
        .section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        label { display: block; font-weight: 600; margin-bottom: 10px; }
        input[type="text"] { width: 100%; padding: 12px; font-size: 16px; border: 1px solid #d2d2d7; border-radius: 10px; box-sizing: border-box; }
        input[type="file"] { margin-top: 10px; }
        .checkbox-wrapper { display: flex; align-items: center; margin-top: 15px; }
        .checkbox-wrapper input { margin-right: 10px; width: 20px; height: 20px; }
        button { background: #0071e3; color: white; border: none; padding: 15px 30px; font-size: 18px; font-weight: 600; border-radius: 30px; cursor: pointer; transition: background 0.2s; width: 100%; }
        button:hover { background: #0077ed; }
        
        .result-box { display: none; margin-top: 30px; background: #fbfbfd; border-radius: 15px; padding: 20px; border: 1px solid #e5e5e5; }
        .score-circle { width: 100px; height: 100px; border-radius: 50%; background: #333; color: white; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold; margin: 0 auto 20px; }
        .breakdown { display: flex; justify-content: space-between; gap: 20px; }
        .breakdown-col { flex: 1; }
        .metric { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .good { color: #28cd41; font-weight: bold; }
        .bad { color: #ff3b30; font-weight: bold; }
        .neutral { color: #8e8e93; }
        
        #preview { max-width: 100%; height: auto; margin-top: 15px; border-radius: 10px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>Virality Strength Calculator</h1>
    <p>Based on the <i>1of10 YouTube Data Report 2025</i> for Educational Channels.</p>

    <div class="section">
        <label>Video Title</label>
        <input type="text" id="titleInput" placeholder="e.g., Why This Water Sounds Like Glass">
    </div>

    <div class="section">
        <label>Thumbnail Image</label>
        <input type="file" id="imageInput" accept="image/*">
        <img id="preview" />
        
        <div class="checkbox-wrapper">
            <input type="checkbox" id="faceCheck">
            <label for="faceCheck" style="margin:0; font-weight: normal;">Does the thumbnail include a face? (Required for +4% lift)</label>
        </div>
    </div>

    <button onclick="calculateVirality()">Analyze Virality</button>

    <div class="result-box" id="resultBox">
        <div class="score-circle" id="totalScore">0.0</div>
        <div style="text-align: center; margin-bottom: 20px; font-weight: 600; font-size: 18px;" id="verdict">Low Potential</div>
        
        <div class="breakdown">
            <div class="breakdown-col">
                <h4>Title Metrics</h4>
                <div id="titleMetrics"></div>
            </div>
            <div class="breakdown-col">
                <h4>Thumbnail Metrics</h4>
                <div id="thumbMetrics"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // Configuration from PDF Data
    const NEGATIVE_WORDS = ['broken', 'wrong', 'danger', 'impossible', 'dead', 'bad', 'stop', 'warning', 'secret', 'hidden', 'trap', 'fail'];
    const CURIOSITY_WORDS = ['why', 'what', 'how', '?', 'this'];
    
    function calculateVirality() {
        const title = document.getElementById('titleInput').value;
        const facePresent = document.getElementById('faceCheck').checked;
        const fileInput = document.getElementById('imageInput');
        
        if (!title) { alert("Please enter a title."); return; }
        
        // 1. Analyze Title
        let tScore = 5;
        let tLog = [];
        
        // Length Check (< 60 chars is optimal)
        if (title.length < 60) {
            tScore += 1;
            tLog.push(`<div class="metric"><span>Short Length (<60)</span><span class="good">+1.0</span></div>`);
        } else if (title.length > 80) {
            tScore -= 1;
            tLog.push(`<div class="metric"><span>Length (>80 chars)</span><span class="bad">-1.0</span></div>`);
        } else {
            tLog.push(`<div class="metric"><span>Length (60-80)</span><span class="neutral">0.0</span></div>`);
        }

        // Negativity Bias (+22% Lift)
        const lowerTitle = title.toLowerCase();
        const hasNegative = NEGATIVE_WORDS.some(w => lowerTitle.includes(w));
        if (hasNegative) {
            tScore += 2;
            tLog.push(`<div class="metric"><span>Negative Sentiment</span><span class="good">+2.0</span></div>`);
        } else {
            tLog.push(`<div class="metric"><span>Negative Sentiment</span><span class="neutral">0.0</span></div>`);
        }

        // Curiosity Gap
        const hasCuriosity = CURIOSITY_WORDS.some(w => lowerTitle.includes(w));
        if (hasCuriosity) {
            tScore += 1;
            tLog.push(`<div class="metric"><span>Curiosity Gap</span><span class="good">+1.0</span></div>`);
        }

        // Specific Data (Numbers)
        if (/\d/.test(title)) {
            tScore += 1;
            tLog.push(`<div class="metric"><span>Specific Data (Nums)</span><span class="good">+1.0</span></div>`);
        }

        tScore = Math.min(10, Math.max(1, tScore));

        // 2. Analyze Thumbnail (if image exists)
        if (fileInput.files && fileInput.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    analyzeImage(img, tScore, tLog, facePresent);
                }
                img.src = e.target.result;
            }
            reader.readAsDataURL(fileInput.files[0]);
        } else {
            // If no image, just assume neutral thumb score for demo
            finishCalculation(tScore, 5, tLog, ["<div class='metric'>No Image Uploaded</div>"]);
        }
    }

    function analyzeImage(img, tScore, tLog, facePresent) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 200; // Resize for speed
        canvas.height = 200 * (img.height / img.width);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        
        const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        let r, g, b, avg;
        let totalBrightness = 0;
        let colorBuckets = { cyan: 0, green: 0, yellow: 0, other: 0 };
        
        for (let i = 0; i < data.length; i += 4) {
            r = data[i];
            g = data[i+1];
            b = data[i+2];
            
            // Brightness (Luminance)
            avg = 0.299*r + 0.587*g + 0.114*b;
            totalBrightness += avg;
            
            // Color Analysis (HSV approximation)
            let max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, v = max;
            let d = max - min;
            s = max === 0 ? 0 : d / max;
            
            if (max === min) { h = 0; }
            else {
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            
            // Hue in degrees 0-360
            let hue = h * 360;
            
            // Saturation threshold to count as "color"
            if (s > 0.2 && v > 50) {
                if (hue > 160 && hue < 200) colorBuckets.cyan++;
                else if (hue > 80 && hue < 160) colorBuckets.green++;
                else if (hue > 40 && hue < 70) colorBuckets.yellow++;
                else colorBuckets.other++;
            }
        }
        
        const avgBrightness = totalBrightness / (data.length / 4);
        
        let mScore = 5;
        let mLog = [];
        
        // Brightness Score
        // Report says peak is 100-110
        if (avgBrightness >= 100 && avgBrightness <= 115) {
            mScore += 3;
            mLog.push(`<div class="metric"><span>Brightness (${Math.round(avgBrightness)})</span><span class="good">+3.0 (Peak)</span></div>`);
        } else if (avgBrightness >= 90 && avgBrightness <= 130) {
            mScore += 1;
            mLog.push(`<div class="metric"><span>Brightness (${Math.round(avgBrightness)})</span><span class="good">+1.0</span></div>`);
        } else if (avgBrightness < 70) {
            mScore -= 1;
            mLog.push(`<div class="metric"><span>Brightness (${Math.round(avgBrightness)})</span><span class="bad">-1.0 (Too Dark)</span></div>`);
        } else {
            mLog.push(`<div class="metric"><span>Brightness (${Math.round(avgBrightness)})</span><span class="neutral">0.0</span></div>`);
        }

        // Color Bonus
        const totalPixels = data.length / 4;
        // If > 10% of pixels are a specific viral color
        if (colorBuckets.cyan / totalPixels > 0.1) {
            mScore += 2;
            mLog.push(`<div class="metric"><span>Dominant Cyan</span><span class="good">+2.0</span></div>`);
        } else if (colorBuckets.green / totalPixels > 0.1) {
            mScore += 2;
            mLog.push(`<div class="metric"><span>Dominant Green</span><span class="good">+2.0</span></div>`);
        } else if (colorBuckets.yellow / totalPixels > 0.1) {
            mScore += 1.5;
            mLog.push(`<div class="metric"><span>Dominant Yellow</span><span class="good">+1.5</span></div>`);
        }

        // Face Bonus
        if (facePresent) {
            mScore += 1;
            mLog.push(`<div class="metric"><span>Face Present</span><span class="good">+1.0</span></div>`);
        }

        mScore = Math.min(10, Math.max(1, mScore));
        finishCalculation(tScore, mScore, tLog, mLog);
    }

    function finishCalculation(tScore, mScore, tLog, mLog) {
        const total = ((tScore * 0.5) + (mScore * 0.5)).toFixed(1);
        
        document.getElementById('totalScore').innerText = total;
        document.getElementById('titleMetrics').innerHTML = tLog.join('');
        document.getElementById('thumbMetrics').innerHTML = mLog.join('');
        document.getElementById('resultBox').style.display = 'block';
        
        let verdict = "Low Viral Potential";
        let color = "#ff3b30";
        if (total >= 8.0) { verdict = "High Viral Probability!"; color = "#28cd41"; }
        else if (total >= 6.0) { verdict = "Good Potential"; color = "#ffcc00"; }
        
        const vEl = document.getElementById('verdict');
        vEl.innerText = verdict;
        vEl.style.color = color;
        document.getElementById('totalScore').style.backgroundColor = color;
    }
    
    // Preview Image
    document.getElementById('imageInput').onchange = function(evt) {
        const tgt = evt.target || window.event.srcElement, files = tgt.files;
        if (FileReader && files && files.length) {
            const fr = new FileReader();
            fr.onload = function () {
                const p = document.getElementById('preview');
                p.src = fr.result;
                p.style.display = 'block';
            }
            fr.readAsDataURL(files[0]);
        }
    }
</script>

</body>
</html>
